<!DOCTYPE html>
<html>
  <head>
    <title>Certificate Generator v0.2</title>
    <style>
      body {
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      form {
        padding: 10px 5px 15px 5px;
        border: 1px solid gray;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: stretch;
      }

      h2 {
        text-align: center;
      }

      .input {
        padding: 5px;
        margin: 5px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: stretch;
      }

      .input input {
        padding: 5px 5px 5px 10px;
        margin: 2px;
        font-size: 15px;
      }

      .input label {
        margin: 0px 0px 2px;
        font-size: 14px;
      }

      .input button {
        padding: 5px;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <form id="form">
      <h2>Form Info</h2>
      <div class="input">
        <label for="id_number"> Student ID Number </label>
        <input id="id_number" placeholder="id_number" />
      </div>
      <div class="input">
        <label for="id_number"> Gcash Ref. No. </label>
        <input id="ref_number" placeholder="Gcash reference number" />
      </div>
      <div class="input">
        <button type="submit">Submit</button>
      </div>
    </form>
    <script>
      const form = document.getElementById("form");
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const id_no = document.getElementById("id_number").value;
        const ref_no = document.getElementById("ref_number").value;

        var downloadBlob, downloadURL;

        downloadBlob = function (data, fileName, mimeType) {
          var blob, url;
          blob = new Blob([data], {
            type: mimeType,
          });
          url = window.URL.createObjectURL(blob);
          downloadURL(url, fileName);
          setTimeout(function () {
            return window.URL.revokeObjectURL(url);
          }, 1000);
        };

        downloadURL = function (data, fileName) {
          var a;
          a = document.createElement("a");
          a.href = data;
          a.download = fileName;
          document.body.appendChild(a);
          a.style = "display: none";
          a.click();
          a.remove();
        };

        fetch("/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ id_no, ref_no }),
        })
          .then((response) => response.blob())
          .then((data) => {
            downloadBlob(data, "try.pdf", "application/pdf");
          })
          .catch((error) => console.error(error));
      });
    </script>
  </body>
</html>
